<?xml version="1.0" encoding="UTF-8"?>
<!--
    SpotBugs exclusion filter for NextSkip project.

    This file excludes false positives and generated code from SpotBugs analysis.
    Add exclusions sparingly and document the reason for each.
-->
<FindBugsFilter>
    <!-- Exclude generated code (e.g., Hilla endpoints, Lombok) -->
    <Match>
        <Package name="~.*\.generated.*"/>
    </Match>

    <!--
        EI_EXPOSE_REP and EI_EXPOSE_REP2: DTOs intentionally expose internal representation.
        Jackson requires getters/setters for XML/JSON deserialization. These are internal
        DTOs used only for parsing external API responses, not exposed to clients.
    -->
    <Match>
        <Class name="~io\.nextskip\..*\.dto\..*"/>
        <Bug pattern="EI_EXPOSE_REP,EI_EXPOSE_REP2"/>
    </Match>

    <!--
        MeteorShowerDataLoader: ObjectMapper is injected by Spring and is thread-safe.
        Storing it is the intended Spring pattern for component-scoped dependencies.
    -->
    <Match>
        <Class name="io.nextskip.meteors.internal.MeteorShowerDataLoader"/>
        <Bug pattern="EI_EXPOSE_REP2"/>
    </Match>

    <!--
        *RefreshTask classes: Repository beans are Spring-managed singletons.
        Storing Spring-injected beans directly is the standard DI pattern.
        These are constructor-injected dependencies, not exposed to external code.
    -->
    <Match>
        <Class name="~io\.nextskip\..*\.scheduler\.\w+RefreshTask"/>
        <Bug pattern="EI_EXPOSE_REP2"/>
    </Match>

    <!--
        VA_FORMAT_STRING_USES_NEWLINE: Test JSON/XML strings use \n for readability.
        Using %n would make test data harder to read and maintain.
    -->
    <Match>
        <Source name="~.*Test\.java"/>
        <Bug pattern="VA_FORMAT_STRING_USES_NEWLINE"/>
    </Match>

    <!--
        BC_VACUOUS_INSTANCEOF: Tests intentionally verify interface implementations.
        Tests like "assertTrue(activation instanceof Scoreable)" verify class structure.
    -->
    <Match>
        <Source name="~.*Test\.java"/>
        <Bug pattern="BC_VACUOUS_INSTANCEOF"/>
    </Match>

    <!--
        MS_EXPOSE_REP: TestPostgresContainer singleton intentionally shares mutable container.
        This follows Testcontainers' recommended singleton pattern for test performance.
    -->
    <Match>
        <Class name="io.nextskip.test.TestPostgresContainer"/>
        <Bug pattern="MS_EXPOSE_REP"/>
    </Match>

    <!--
        EI_EXPOSE_REP2: Test fixtures intentionally store mutable objects for builder pattern.
        Security concerns about mutable object exposure don't apply to test code.
    -->
    <Match>
        <Package name="io.nextskip.test.fixtures"/>
        <Bug pattern="EI_EXPOSE_REP,EI_EXPOSE_REP2"/>
    </Match>
</FindBugsFilter>
